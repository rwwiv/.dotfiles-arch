#!/bin/bash
# YADM Bootstrap Script
# Runs automatically after 'yadm clone' or when manually executed via 'yadm bootstrap'
#
# This script is INTERACTIVE - it prompts before each section.
#
# Steps:
# 1. Copy files to /etc (for security, copies rather than symlinks)
# 2. Install packages (core, hardware, gui, optional) and remove unwanted packages
# 3. Set up Git LFS
# 4. Enable systemd services
# 5. Set up Hyprland plugins
# 6. Install mise tools (uv, harlequin)
# 7. Configure default applications
# 8. Hardware setup (fingerprint reader udev rules)
# 9. Omarchy optional setup (Xbox controllers, Windows VM)

set -e

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
MAGENTA='\033[0;35m'
CYAN='\033[0;36m'
BOLD='\033[1m'
NC='\033[0m' # No Color

# Get dotfiles directory (yadm worktree)
DOTFILES_DIR="$HOME"

# If running from local dotfiles directory, use that instead
if [[ -f ".config/.yadm-project" ]]; then
	DOTFILES_DIR="$(pwd)"
fi

# User services to enable (headless-safe)
USER_SERVICES_HEADLESS=(
	"git-maintenance@daily.timer"
)

# User services requiring GUI
USER_SERVICES_GUI=(
	# --- Desktop Core ---
	"hypridle.service"
	"mako.service"
	"waybar.service"
	"xdg-user-dirs.service"

	# --- Audio & Media ---
	"wireplumber.service"
	"pipewire.socket"
	"pipewire-pulse.socket"

	# --- Hardware & Tools ---
	"cameractrlsd.service"
	"ddcutil-service.service"
	"ddcutil_cache_daemon.service"

	# --- Custom / Personal ---
	"elephant.service"
	"powermon.service"
	"screenshare_optimizer.service"

	# --- Timers (Scheduled Tasks) ---
	"omarchy-battery-monitor.timer"
	"swww-rand.timer"

	# --- Security/Auth (Sockets) ---
	"gnome-keyring-daemon.socket"
	"p11-kit-server.socket"
)


# ============================================================================
# Helper functions
# ============================================================================
print_header() {
	echo
	echo -e "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
	echo -e "${BLUE}  $1${NC}"
	echo -e "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
	echo
}

print_success() {
	echo -e "${GREEN}✓${NC} $1"
}

print_error() {
	echo -e "${RED}✗${NC} $1"
}

print_warning() {
	echo -e "${YELLOW}⚠${NC} $1"
}

print_info() {
	echo -e "${MAGENTA}→${NC} $1"
}

print_skip() {
	echo -e "${YELLOW}⊘${NC} $1"
}

# Prompt for yes/no - returns 0 for yes, 1 for no
# Usage: if prompt_yn "Do something?"; then ... fi
prompt_yn() {
	local prompt="$1"
	local default="${2:-y}"  # default to yes

	local yn_hint
	if [[ "$default" == "y" ]]; then
		yn_hint="[Y/n]"
	else
		yn_hint="[y/N]"
	fi

	echo -en "${CYAN}?${NC} ${prompt} ${yn_hint} "
	read -r response

	# Empty response uses default
	if [[ -z "$response" ]]; then
		response="$default"
	fi

	case "$response" in
		[yY]|[yY][eE][sS]) return 0 ;;
		*) return 1 ;;
	esac
}

# ============================================================================
# Main bootstrap
# ============================================================================
print_header "YADM Bootstrap"
echo "Dotfiles directory: $DOTFILES_DIR"
echo

# ============================================================================
# 1. Copy /etc files
# ============================================================================
if [[ -d "$DOTFILES_DIR/etc" ]]; then
	if prompt_yn "Copy system files to /etc?"; then
		print_header "Step 1: System Files (/etc)"

		print_info "Copying files to /etc from $DOTFILES_DIR/etc..."
		echo

		# Track what was changed for service reloads
		CHANGED_SYSCTL=0
		CHANGED_UDEV=0
		CHANGED_SYSTEMD=0
		CHANGED_KEYD=0
		CHANGED_MODPROBE=0

		# Function to copy files recursively
		copy_files() {
			local src_base="$1"
			local dst_base="$2"
			local has_errors=0
			local src_file rel_path dst_file dst_dir target_mode

			while IFS= read -r src_file; do
				# Get relative path from src_base
				rel_path="${src_file#"$src_base"/}"
				dst_file="$dst_base/$rel_path"
				dst_dir=$(dirname "$dst_file")

				# Determine target permissions: preserve executable bit, otherwise 644
				if [[ -x "$src_file" ]]; then
					target_mode="755"
				else
					target_mode="644"
				fi

				# Create destination directory if needed
				if [[ ! -d "$dst_dir" ]]; then
					if sudo mkdir -p "$dst_dir" 2>/dev/null; then
						print_info "Created directory: $dst_dir"
					else
						print_error "Failed to create directory: $dst_dir"
						has_errors=1
						continue
					fi
				fi

				# Helper to copy and set permissions
				do_copy() {
					if sudo cp "$src_file" "$dst_file" 2>/dev/null && \
					   sudo chown root:root "$dst_file" 2>/dev/null && \
					   sudo chmod "$target_mode" "$dst_file" 2>/dev/null; then
						# Track changes for service reloads
						case "$rel_path" in
							sysctl.d/*) CHANGED_SYSCTL=1 ;;
							udev/rules.d/*) CHANGED_UDEV=1 ;;
							systemd/system/*) CHANGED_SYSTEMD=1 ;;
							keyd/*) CHANGED_KEYD=1 ;;
							modprobe.d/*) CHANGED_MODPROBE=1 ;;
						esac
						return 0
					else
						return 1
					fi
				}

				# Check if file exists and compare
				if [[ -e "$dst_file" ]]; then
					# Compare files to see if they're different
					if cmp -s "$src_file" "$dst_file" 2>/dev/null; then
						# File content matches, verify ownership and permissions
						local current_owner current_mode
						current_owner=$(stat -c '%u:%g' "$dst_file" 2>/dev/null)
						current_mode=$(stat -c '%a' "$dst_file" 2>/dev/null)

						if [[ "$current_owner" != "0:0" || "$current_mode" != "$target_mode" ]]; then
							if sudo chown root:root "$dst_file" 2>/dev/null && \
							   sudo chmod "$target_mode" "$dst_file" 2>/dev/null; then
								print_success "Fixed permissions: $rel_path"
							else
								print_error "Failed to fix permissions: $rel_path"
								has_errors=1
							fi
						else
							print_success "Already up-to-date: $rel_path"
						fi
					else
						print_warning "File exists (backing up): $dst_file"
						if sudo mv "$dst_file" "$dst_file.bak.$(date +%Y%m%d-%H%M%S)" 2>/dev/null; then
							if do_copy; then
								print_success "Copied (after backup): $rel_path"
							else
								print_error "Failed to copy file: $rel_path"
								has_errors=1
							fi
						else
							print_error "Failed to backup: $dst_file"
							has_errors=1
						fi
					fi
				else
					if do_copy; then
						print_success "Copied: $rel_path"
					else
						print_error "Failed to copy file: $rel_path"
						has_errors=1
					fi
				fi
			done < <(find "$src_base" -type f -o -type l)

			return $has_errors
		}

		if copy_files "$DOTFILES_DIR/etc" "/etc"; then
			echo
			print_success "System files copied successfully"
		else
			echo
			print_warning "System file copies completed with some errors"
		fi

		# Reload services based on what changed
		echo
		print_info "Reloading affected system services..."

		if [[ $CHANGED_SYSCTL -eq 1 ]]; then
			if sudo sysctl --system >/dev/null 2>&1; then
				print_success "Reloaded sysctl settings"
			else
				print_warning "Failed to reload sysctl settings"
			fi
		fi

		if [[ $CHANGED_UDEV -eq 1 ]]; then
			if sudo udevadm control --reload-rules 2>/dev/null && sudo udevadm trigger 2>/dev/null; then
				print_success "Reloaded udev rules"
			else
				print_warning "Failed to reload udev rules"
			fi
		fi

		if [[ $CHANGED_SYSTEMD -eq 1 ]]; then
			if sudo systemctl daemon-reload 2>/dev/null; then
				print_success "Reloaded systemd daemon"
				# Enable and start any timers we manage
				for unit in "$DOTFILES_DIR/etc/systemd/system"/*.timer; do
					if [[ -f "$unit" ]]; then
						unit_name=$(basename "$unit")
						if sudo systemctl enable "$unit_name" 2>/dev/null; then
							sudo systemctl start "$unit_name" 2>/dev/null || true
							print_success "Enabled $unit_name"
						fi
					fi
				done
			else
				print_warning "Failed to reload systemd daemon"
			fi
		fi

		if [[ $CHANGED_KEYD -eq 1 ]]; then
			if sudo systemctl restart keyd 2>/dev/null; then
				print_success "Restarted keyd service"
			else
				print_warning "Failed to restart keyd (may not be installed)"
			fi
		fi

		if [[ $CHANGED_MODPROBE -eq 1 ]]; then
			print_info "modprobe.d changes will take effect on next module load or reboot"
		fi
	else
		print_skip "Skipping system file copies"
	fi
else
	print_info "No system files found (no etc/ directory)"
fi

# ============================================================================
# 2. Install packages
# ============================================================================
if prompt_yn "Install packages?"; then
	print_header "Step 2: Package Installation"

	# Check for paru (AUR helper)
	if ! command -v paru &> /dev/null; then
		print_error "paru (AUR helper) is not installed"
		echo
		echo "Install paru first:"
		echo "  sudo pacman -S --needed git base-devel"
		echo "  git clone https://aur.archlinux.org/paru.git"
		echo "  cd paru && makepkg -si"
		echo
		exit 1
	fi
	print_success "paru is installed"

	# Create yay symlink for compatibility with omarchy scripts
	if [[ ! -e /usr/local/bin/yay ]]; then
		print_info "Creating yay -> paru symlink for compatibility..."
		if sudo ln -s /usr/bin/paru /usr/local/bin/yay 2>/dev/null; then
			print_success "Created /usr/local/bin/yay -> /usr/bin/paru symlink"
		else
			print_warning "Failed to create yay symlink (may need manual setup)"
		fi
	elif [[ -L /usr/local/bin/yay ]]; then
		print_success "yay symlink already exists"
	else
		print_warning "/usr/local/bin/yay exists but is not a symlink"
	fi
	echo

	# Helper function to install from a .packages file
	install_packages() {
		local pkg_file="$1"
		local description="$2"
		local log_name="$3"

		if [[ -f "$pkg_file" ]]; then
			print_info "Installing $description from $(basename "$pkg_file")..."
			echo

			if grep -v '^#' "$pkg_file" | grep -v '^[[:space:]]*$' | paru -S --needed --noconfirm - 2>&1 | tee "/tmp/yadm-bootstrap-${log_name}.log"; then
				print_success "$description installed"
			else
				print_warning "Some packages failed to install (see /tmp/yadm-bootstrap-${log_name}.log)"
			fi
			echo
		else
			print_info "$(basename "$pkg_file") not found (skipping)"
		fi
	}

	# Core packages (always)
	install_packages "$DOTFILES_DIR/core.packages" "core packages" "core"

	# Hardware packages (always)
	install_packages "$DOTFILES_DIR/hardware.packages" "hardware packages" "hardware"

	# GUI packages
	if prompt_yn "Install GUI packages?"; then
		install_packages "$DOTFILES_DIR/gui.packages" "GUI packages" "gui"
	else
		print_skip "Skipping GUI packages"
	fi

	# Optional packages
	if prompt_yn "Install optional packages?"; then
		install_packages "$DOTFILES_DIR/optional.packages" "optional packages" "optional"

		# Optional GUI packages
		if prompt_yn "Install optional GUI packages?"; then
			install_packages "$DOTFILES_DIR/optional-gui.packages" "optional GUI packages" "optional-gui"
		else
			print_skip "Skipping optional GUI packages"
		fi
	else
		print_skip "Skipping optional packages"
	fi

	# Remove packages listed in removals.packages
	# This runs AFTER optional packages so TLP is installed before ppd removal
	if [[ -f "$DOTFILES_DIR/removals.packages" ]]; then
		print_info "Checking for packages to remove (from removals.packages)..."
		echo

		packages_found=()
		while IFS= read -r pkg || [[ -n "$pkg" ]]; do
			# Skip comments and empty lines
			[[ "$pkg" =~ ^[[:space:]]*# ]] && continue
			[[ -z "${pkg// }" ]] && continue
			pkg="${pkg%% #*}"  # Remove inline comments
			pkg="${pkg// }"    # Trim whitespace

			# Conditional removal: power-profiles-daemon only if TLP is installed
			if [[ "$pkg" == "power-profiles-daemon" ]]; then
				if ! pacman -Qi tlp &>/dev/null; then
					print_info "Skipping power-profiles-daemon removal (TLP not installed)"
					continue
				fi
			fi

			if pacman -Qi "$pkg" &>/dev/null; then
				packages_found+=("$pkg")
			fi
		done < "$DOTFILES_DIR/removals.packages"

		if [[ ${#packages_found[@]} -gt 0 ]]; then
			print_info "Found packages to remove: ${packages_found[*]}"
			if prompt_yn "Remove these packages?"; then
				if paru -Rns --noconfirm "${packages_found[@]}" 2>&1 | tee /tmp/yadm-bootstrap-remove.log; then
					print_success "Packages removed successfully"
				else
					print_warning "Some packages may not have been removed (see /tmp/yadm-bootstrap-remove.log)"
				fi
			else
				print_skip "Skipping package removal"
			fi
		else
			print_success "No packages to remove"
		fi
		echo
	fi
else
	print_skip "Skipping package installation"
fi

# ============================================================================
# 3. Git LFS setup
# ============================================================================
if prompt_yn "Set up Git LFS?"; then
	print_header "Step 3: Git LFS"

	if command -v git-lfs &> /dev/null; then
		print_info "Setting up Git LFS..."
		if git lfs install 2>&1 | grep -q "Updated\|already"; then
			print_success "Git LFS configured"
		else
			print_warning "Git LFS setup may have failed"
		fi
	else
		print_warning "git-lfs not installed (install via packages)"
	fi
else
	print_skip "Skipping Git LFS setup"
fi

# ============================================================================
# 4. Enable systemd services
# ============================================================================
if prompt_yn "Enable systemd user services?"; then
	print_header "Step 4: Systemd Services"
	print_info "Reloading systemd user daemon..."
	systemctl --user daemon-reload
	echo

	# Helper function to enable services
	enable_services() {
		local services=("$@")
		for service in "${services[@]}"; do
			# Check if service exists
			if systemctl --user list-unit-files "$service" &>/dev/null; then
				if systemctl --user enable "$service" 2>/dev/null; then
					if systemctl --user start "$service" 2>/dev/null; then
						print_success "$service enabled and started"
					else
						print_warning "$service enabled but failed to start"
					fi
				else
					print_warning "$service could not be enabled"
				fi
			else
				print_warning "$service not found (may not be installed yet)"
			fi
		done
	}

	# Enable headless services
	print_info "Enabling headless services..."
	enable_services "${USER_SERVICES_HEADLESS[@]}"

	# Enable GUI services
	echo
	print_info "Enabling GUI services..."
	enable_services "${USER_SERVICES_GUI[@]}"
	echo
else
	print_skip "Skipping systemd services"
fi

# ============================================================================
# 5. Hyprland plugins
# ============================================================================
if command -v hyprpm &> /dev/null; then
	if prompt_yn "Set up Hyprland plugins?"; then
		print_header "Step 5: Hyprland Plugins"

		print_info "Setting up split-monitor-workspaces plugin..."
		echo

		# Check if already added
		if hyprpm list | grep -q "split-monitor-workspaces"; then
			print_success "Plugin already added"
		else
			print_info "Adding plugin repository..."
			if hyprpm add https://github.com/Duckonaut/split-monitor-workspaces 2>&1 | tee /tmp/yadm-bootstrap-hyprpm.log; then
				print_success "Plugin repository added"
			else
				print_error "Failed to add plugin repository (see /tmp/yadm-bootstrap-hyprpm.log)"
			fi
		fi

		print_info "Enabling plugin..."
		if hyprpm enable split-monitor-workspaces 2>/dev/null; then
			print_success "Plugin enabled"
		else
			print_warning "Failed to enable plugin (may already be enabled)"
		fi

		print_info "Reloading plugins..."
		if hyprpm reload 2>/dev/null; then
			print_success "Plugins reloaded"
		else
			print_warning "Failed to reload plugins (Hyprland may not be running)"
		fi
		echo
	else
		print_skip "Skipping Hyprland plugins"
	fi
fi

# ============================================================================
# 6. Mise tools (uv, harlequin)
# ============================================================================
if command -v mise &> /dev/null; then
	if prompt_yn "Install mise tools (uv, harlequin)?"; then
		print_header "Step 6: Mise Tools"

		print_info "Installing uv via mise..."
		if mise use -g uv 2>&1 | tee -a /tmp/yadm-bootstrap-mise.log; then
			print_success "uv installed via mise"

			# Now install harlequin via uv (use upgrade to be idempotent)
			print_info "Installing harlequin via uv tool install..."
			if uv tool install --upgrade harlequin 2>&1 | tee -a /tmp/yadm-bootstrap-mise.log; then
				print_success "harlequin installed"
			else
				print_warning "Failed to install harlequin (see /tmp/yadm-bootstrap-mise.log)"
			fi
		else
			print_warning "Failed to install uv via mise (see /tmp/yadm-bootstrap-mise.log)"
		fi
		echo
	else
		print_skip "Skipping mise tools"
	fi
fi

# ============================================================================
# 7. Default applications
# ============================================================================
if command -v xdg-mime &> /dev/null; then
	if prompt_yn "Configure default applications (PDF viewer)?"; then
		print_header "Step 7: Default Applications"

		print_info "Configuring zathura as default PDF reader..."

		if xdg-mime default org.pwmt.zathura.desktop application/pdf 2>/dev/null; then
			print_success "Zathura set as default PDF reader"
		else
			print_warning "Failed to set zathura as default (may not be installed yet)"
		fi
		echo
	else
		print_skip "Skipping default applications"
	fi
fi

# ============================================================================
# 8. Hardware Setup (fingerprint reader)
# ============================================================================
# Look for known fingerprint reader vendors/keywords, exclude touchpads
# Use /usr/bin/grep explicitly in case grep is aliased to ripgrep
FPRINT_DEVICE=$(lsusb 2>/dev/null | /usr/bin/grep -iE "fingerprint|goodix|synaptics|elan|authentec|validity|fpc|upek" | /usr/bin/grep -ivE "touchpad|trackpad" | head -1)
if [[ -n "$FPRINT_DEVICE" ]]; then
	if prompt_yn "Set up fingerprint reader udev rules?"; then
		print_header "Step 8: Hardware Setup"

		# Extract vendor:product IDs (format: "ID 27c6:6594")
		# Use /usr/bin/grep for -oP (Perl regex) which rg may not support
		FPRINT_IDS=$(echo "$FPRINT_DEVICE" | /usr/bin/grep -oP 'ID \K[0-9a-f]{4}:[0-9a-f]{4}')
		FPRINT_VENDOR=$(echo "$FPRINT_IDS" | cut -d: -f1)
		FPRINT_PRODUCT=$(echo "$FPRINT_IDS" | cut -d: -f2)

		if [[ -n "$FPRINT_VENDOR" && -n "$FPRINT_PRODUCT" ]]; then
			FPRINT_RULE="/etc/udev/rules.d/99-fprint-no-autosuspend.rules"
			FPRINT_RULE_CONTENT="ACTION==\"bind\", SUBSYSTEM==\"usb\", ATTR{idVendor}==\"$FPRINT_VENDOR\", ATTR{idProduct}==\"$FPRINT_PRODUCT\", TEST==\"power/control\", ATTR{power/control}=\"on\""

			print_info "Detected fingerprint reader: $FPRINT_IDS"

			if [[ -f "$FPRINT_RULE" ]]; then
				print_success "Fingerprint udev rule already exists"
			else
				print_info "Creating fingerprint autosuspend udev rule..."
				if echo "$FPRINT_RULE_CONTENT" | sudo tee "$FPRINT_RULE" > /dev/null 2>&1; then
					print_success "Created $FPRINT_RULE"
					sudo udevadm control --reload-rules 2>/dev/null
				else
					print_warning "Failed to create fingerprint udev rule"
				fi
			fi
		fi
		echo
	else
		print_skip "Skipping fingerprint reader setup"
	fi
fi

# ============================================================================
# 9. Omarchy Local Patches
# ============================================================================
OMARCHY_DIR="$HOME/.local/share/omarchy"
LOCAL_PATCH="$HOME/local.patch"

if [[ -f "$LOCAL_PATCH" && -d "$OMARCHY_DIR" ]]; then
	if prompt_yn "Apply local.patch to omarchy?"; then
		print_header "Step 9: Omarchy Local Patches"

		print_info "Applying local.patch to omarchy..."
		if (cd "$OMARCHY_DIR" && git apply --check "$LOCAL_PATCH" 2>/dev/null); then
			if (cd "$OMARCHY_DIR" && git apply "$LOCAL_PATCH" 2>&1 | tee -a /tmp/yadm-bootstrap-omarchy.log); then
				print_success "local.patch applied successfully"
			else
				print_warning "Failed to apply local.patch (see /tmp/yadm-bootstrap-omarchy.log)"
			fi
		else
			# Check if patch is already applied (reverse check)
			if (cd "$OMARCHY_DIR" && git apply --check --reverse "$LOCAL_PATCH" 2>/dev/null); then
				print_success "local.patch already applied"
			else
				print_warning "local.patch cannot be applied (may have conflicts or partial application)"
			fi
		fi
		echo
	else
		print_skip "Skipping omarchy patches"
	fi
fi

# ============================================================================
# 10. Omarchy Optional Setup
# ============================================================================
STATE_DIR="$HOME/.local/state/yadm-bootstrap"

# Xbox controller support (xpadneo)
XBOX_STATE="$STATE_DIR/xbox-controllers-installed"
if [[ -f "$XBOX_STATE" ]]; then
	print_success "Xbox controller support already configured"
elif prompt_yn "Set up Xbox controller support (xpadneo)?"; then
	print_header "Step 10: Xbox Controller Support"
	mkdir -p "$STATE_DIR"

	print_info "Installing xpadneo driver..."

	# Install linux-headers and xpadneo-dkms
	if paru -S --needed --noconfirm linux-headers xpadneo-dkms 2>&1 | tee -a /tmp/yadm-bootstrap-xbox.log; then
		print_success "xpadneo-dkms installed"
	else
		print_warning "Failed to install xpadneo-dkms"
	fi

	# Blacklist xpad driver to prevent conflict
	print_info "Configuring kernel modules..."
	echo "blacklist xpad" | sudo tee /etc/modprobe.d/blacklist-xpad.conf >/dev/null
	print_success "Blacklisted xpad driver"

	# Load xpadneo on boot
	echo "hid_xpadneo" | sudo tee /etc/modules-load.d/xpadneo.conf >/dev/null
	print_success "Added xpadneo to modules-load"

	# Add user to input group for controller access
	if sudo usermod -a -G input "$USER" 2>/dev/null; then
		print_success "Added $USER to input group"
	else
		print_warning "Failed to add user to input group"
	fi

	date -Iseconds > "$XBOX_STATE"
	echo
	print_success "Xbox controller support configured"
	print_warning "Reboot required to activate xpadneo driver"
	echo
else
	print_skip "Skipping Xbox controller setup"
fi

# Windows VM setup
if [[ -x "$HOME/.local/bin/windows-vm-install" ]]; then
	WINDOWS_STATE="$STATE_DIR/windows-vm-installed"
	if [[ -f "$WINDOWS_STATE" ]]; then
		print_success "Windows VM support already configured"
	elif prompt_yn "Set up Windows VM support?"; then
		mkdir -p "$STATE_DIR"

		print_info "Running Windows VM installer..."
		if "$HOME/.local/bin/windows-vm-install" 2>&1 | tee -a /tmp/yadm-bootstrap-windows.log; then
			date -Iseconds > "$WINDOWS_STATE"
			print_success "Windows VM support configured"
		else
			print_warning "Windows VM setup may have failed (see /tmp/yadm-bootstrap-windows.log)"
		fi
		echo
	else
		print_skip "Skipping Windows VM setup"
	fi
fi

# ============================================================================
# Done!
# ============================================================================
print_header "Bootstrap Complete!"

echo "Your dotfiles have been set up successfully!"
echo
echo "Logs saved to:"
echo "  /tmp/yadm-bootstrap-*.log"
echo
echo "Next steps:"
echo "  ${BOLD}•${NC} Restart your shell: ${CYAN}exec zsh${NC}"
echo "  ${BOLD}•${NC} Log out and log back in for all changes to take effect"
echo "  ${BOLD}•${NC} Check for any errors in logs above"
echo

print_success "All done! Enjoy your dotfiles."
echo
