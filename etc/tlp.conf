# /etc/tlp.conf
# Config for ThinkPad P14s Gen 6 (Intel Core Ultra 9 / Lunar Lake)

# ------------------------------------------------------------------------------
# 1. GENERAL & LOGGING
# ------------------------------------------------------------------------------
TLP_ENABLE=1
TLP_WARN_LEVEL=3

# ------------------------------------------------------------------------------
# 2. PROCESSOR (The Core Ultra 9 logic)
# ------------------------------------------------------------------------------
# Intel P-State is the driver for Lunar Lake. 
# We use "powersave" as the governor because the driver handles frequencies internally 
# based on the EPP hint (Energy Performance Preference) below.
CPU_SCALING_GOVERNOR_ON_AC="powersave"
CPU_SCALING_GOVERNOR_ON_BAT="powersave"
CPU_SCALING_GOVERNOR_ON_SAV="powersave"

# EPP Hints:
# default/performance = Max wattage, high heat.
# balance_performance = Good boost, drops quickly when idle. (Best for Dev work)
# balance_power = Prefers lower clocks, boosts only when necessary. (Best for Battery)
# power = Aggressive throttling. (Avoid unless emergency)
CPU_ENERGY_PERF_POLICY_ON_AC="performance"
CPU_ENERGY_PERF_POLICY_ON_BAT="balance_power"
CPU_ENERGY_PERF_POLICY_ON_SAV="power"

# Hardware P-State scaling (HWP)
# 1 = Enable HWP dynamic boost (Recommended for modern Intel)
CPU_HWP_DYN_BOOST_ON_AC=1
CPU_HWP_DYN_BOOST_ON_BAT=0
CPU_HWP_DYN_BOOST_ON_SAV=0

# ------------------------------------------------------------------------------
# 3. PLATFORM PROFILES (ThinkPad ACPI)
# ------------------------------------------------------------------------------
# This controls the ThinkPad firmware modes (Fan curves + PL1/PL2 Power Limits).
# This effectively replaces what you might have used `thinkfan` for, but at a firmware level.
# performance = High fans, high power limits
# balanced = Normal
# low-power = Quiet fans, aggressive throttling
PLATFORM_PROFILE_ON_AC="performance"
PLATFORM_PROFILE_ON_BAT="balanced"
PLATFORM_PROFILE_ON_SAV="low-power"

# ------------------------------------------------------------------------------
# 4. GRAPHICS (Intel Arc/Xe2)
# ------------------------------------------------------------------------------
# Boost GPU frequency on AC for that 120Hz display
INTEL_GPU_MIN_FREQ_ON_AC=800
INTEL_GPU_MAX_FREQ_ON_AC=2350
INTEL_GPU_BOOST_FREQ_ON_AC=2350

# Let it relax on battery
INTEL_GPU_MIN_FREQ_ON_BAT=450
INTEL_GPU_MAX_FREQ_ON_BAT=1650
INTEL_GPU_BOOST_FREQ_ON_BAT=1650

INTEL_GPU_MIN_FREQ_ON_SAV=450
INTEL_GPU_MAX_FREQ_ON_SAV=1400
INTEL_GPU_BOOST_FREQ_ON_SAV=1400

# ------------------------------------------------------------------------------
# 5. STORAGE & USB
# ------------------------------------------------------------------------------
# Enable Audio power saving (hda_intel)
SOUND_POWER_SAVE_ON_AC=1
SOUND_POWER_SAVE_ON_BAT=1
SOUND_POWER_SAVE_ON_SAV=1
SOUND_POWER_SAVE_CONTROLLER="Y"

# PCIe ASPM (Active State Power Management)
# default = Let BIOS decide (Safe)
# powersupersave = Force L1 states (Saves ~1-2W)
PCIE_ASPM_ON_AC="default"
PCIE_ASPM_ON_BAT="default"
PCIE_ASPM_ON_SAV="default"

# USB Autosuspend
# If your mouse/keyboard lags, add its ID to USB_DENYLIST below.
# USB_AUTOSUSPEND=1
# USB_DENYLIST="xxxx:yyyy"

# ------------------------------------------------------------------------------
# 6. BATTERY HEALTH (ThinkPad Exclusive)
# ------------------------------------------------------------------------------
# Since you have a "devbox" setup and likely stay plugged in:
# Stop charging at 80% to extend battery lifespan.
# Start charging only when it drops below 75%.
# START_CHARGE_THRESH_BAT0=75
# STOP_CHARGE_THRESH_BAT0=80

# ------------------------------------------------------------------------------
# 7. RADIO DEVICES
# ------------------------------------------------------------------------------
# Turn off bluetooth on boot? (Optional)
# DEVICES_TO_DISABLE_ON_STARTUP="bluetooth"
