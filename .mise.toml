# Mise configuration for dotfiles repository
# This file is repo-local and provides tasks for managing dotfiles

[tools]
go = "latest"
node = "lts"
rust = "latest"
uv = "latest"
zig = "latest"
zls = "latest"

[settings]
python.uv_venv_auto = true

# ============================================================================
# Dotfiles Management Tasks
# ============================================================================
# These tasks are wrappers around yadm bootstrap and package management
# For simple yadm commands, use yadm directly (e.g., yadm status, yadm push)

# Installation & Setup
[tasks.install]
description = "Full installation (check deps + bootstrap)"
depends = ["check-deps", "bootstrap"]
run = "echo '\nInstallation complete! Restart your shell: exec zsh'"

[tasks.bootstrap]
description = "Run yadm bootstrap (packages, services, /etc symlinks, etc.)"
run = "yadm bootstrap"

[tasks.bootstrap-skip-packages]
description = "Bootstrap without installing packages"
run = "YADM_BOOTSTRAP_SKIP_PACKAGES=1 yadm bootstrap"

[tasks.bootstrap-system-only]
description = "Bootstrap only /etc symlinks"
run = """
YADM_BOOTSTRAP_SKIP_PACKAGES=1 \
YADM_BOOTSTRAP_SKIP_SERVICES=1 \
YADM_BOOTSTRAP_SKIP_HYPRLAND=1 \
YADM_BOOTSTRAP_SKIP_XDG=1 \
yadm bootstrap
"""

[tasks.quick-setup]
description = "Quick setup without packages (for testing)"
run = """
YADM_BOOTSTRAP_SKIP_PACKAGES=1 \
YADM_BOOTSTRAP_SKIP_OPTIONAL=1 \
yadm bootstrap
"""

# Package Management
[tasks.packages-core]
description = "Install core packages only"
run = """
if command -v yay &>/dev/null; then
  yay -S --needed --noconfirm - < pkglist.txt
else
  echo "Error: yay not installed"
  exit 1
fi
"""

[tasks.packages-optional]
description = "Install optional packages only"
run = """
if command -v yay &>/dev/null; then
  yay -S --needed --noconfirm - < pkglist-optional.txt || true
else
  echo "Error: yay not installed"
  exit 1
fi
"""

[tasks.packages-all]
description = "Install all packages (core + optional)"
depends = ["packages-core", "packages-optional"]
run = "echo 'All packages installed'"

# Utilities
[tasks.check-deps]
description = "Check for required dependencies"
run = """
echo "Checking dependencies..."
missing=()

command -v yadm &>/dev/null || missing+=("yadm")
command -v yay &>/dev/null || missing+=("yay")
command -v git &>/dev/null || missing+=("git")
command -v zsh &>/dev/null || missing+=("zsh")

if [[ ${#missing[@]} -gt 0 ]]; then
  echo "Missing dependencies: ${missing[*]}"
  exit 1
else
  echo "âœ“ All dependencies satisfied"
fi
"""

[tasks.migrate]
description = "Run migration script from ansible/stow to yadm"
run = "./migrate-to-yadm.sh"
