#!/bin/zsh
# Stow system files that need root permissions
# This script must be run as root

set -e

# Get the script directory (dotfiles root)
DOTFILES_DIR="$(cd "$(dirname "$0")" && pwd)"

# Check if running as root
if [[ $EUID -ne 0 ]]; then
    echo "Error: This script must be run as root" >&2
    echo "Usage: sudo $0" >&2
    exit 1
fi

# Check if stow is available
if ! command -v stow &> /dev/null; then
    echo "Error: stow is not installed" >&2
    exit 1
fi

# Check if system directory exists
if [[ ! -d "$DOTFILES_DIR/system" ]]; then
    echo "Error: system directory not found at $DOTFILES_DIR/system" >&2
    exit 1
fi

echo "Stowing system files to /..."
cd "$DOTFILES_DIR"

if stow --target=/ system; then
    echo "✓ System files stowed successfully"
else
    echo "✗ Failed to stow system files" >&2
    exit 1
fi
